const std = @import("std");
const KeyEvent = @import("../ui/terminal.zig").KeyEvent;

pub const Command = enum {
    save,
    quit,
    copy,
    cut,
    paste,
    show_file_finder,
    show_command_palette,
    goto_line,
    regex_search,
    project_search,
    toggle_comment,
    move_left,
    move_right,
    move_up,
    move_down,
    move_home,
    move_end,
    page_up,
    page_down,
    select_left,
    select_right,
    select_up,
    select_down,
    select_home,
    select_end,
    select_page_up,
    select_page_down,
    block_select_left,
    block_select_right,
    block_select_up,
    block_select_down,
    add_cursor_up,
    add_cursor_down,
    clear_multi_cursor,
    word_left,
    word_right,
    backspace,
    delete_char,
    insert_newline,
    undo,
    redo,
    lsp_completion,
    lsp_hover,
    lsp_definition,
    lsp_references,
    lsp_jump_back,
    toggle_debug_panel,
    toggle_line_numbers,
};

pub fn mapEditor(event: KeyEvent) ?Command {
    return switch (event) {
        .left => .move_left,
        .right => .move_right,
        .up => .move_up,
        .down => .move_down,
        .home => .move_home,
        .end => .move_end,
        .page_up => .page_up,
        .page_down => .page_down,
        .shift_left => .select_left,
        .shift_right => .select_right,
        .shift_up => .select_up,
        .shift_down => .select_down,
        .shift_home => .select_home,
        .shift_end => .select_end,
        .shift_page_up => .select_page_up,
        .shift_page_down => .select_page_down,
        .alt_left => .block_select_left,
        .alt_right => .block_select_right,
        .alt_up => .block_select_up,
        .alt_down => .block_select_down,
        .word_left => .word_left,
        .word_right => .word_right,
        .backspace => .backspace,
        .delete => .delete_char,
        .enter => .insert_newline,
        .ctrl => |ch| switch (ch) {
            'q' => .quit,
            'x' => .quit,
            'c' => .copy,
            'v' => .paste,
            'k' => .cut,
            's' => .save,
            'p' => .show_file_finder,
            'g' => .goto_line,
            'f' => .regex_search,
            '/' => .toggle_comment,
            'z' => .undo,
            'y' => .redo,
            'n' => .lsp_completion,
            't' => .lsp_hover,
            'd' => .lsp_definition,
            'r' => .lsp_references,
            'o' => .lsp_jump_back,
            'w' => .toggle_debug_panel,
            'l' => .toggle_line_numbers,
            'b' => .move_left,
            'a' => .move_home,
            'e' => .move_end,
            else => null,
        },
        .ctrl_shift => |ch| switch (ch) {
            'p' => .show_command_palette,
            'f' => .project_search,
            'k' => .add_cursor_up,
            'j' => .add_cursor_down,
            'm' => .clear_multi_cursor,
            else => null,
        },
        .cmd => |ch| switch (ch) {
            'q' => .quit,
            'c' => .copy,
            'v' => .paste,
            'x' => .cut,
            's' => .save,
            'p' => .show_file_finder,
            'g' => .goto_line,
            'f' => .regex_search,
            'z' => .undo,
            'y' => .redo,
            'w' => .toggle_debug_panel,
            'l' => .toggle_line_numbers,
            else => null,
        },
        .cmd_shift => |ch| switch (ch) {
            'p' => .show_command_palette,
            'f' => .project_search,
            'k' => .add_cursor_up,
            'j' => .add_cursor_down,
            'm' => .clear_multi_cursor,
            else => null,
        },
        else => null,
    };
}

test "maps multi-cursor shortcuts on ctrl+shift" {
    try std.testing.expectEqual(@as(?Command, .add_cursor_up), mapEditor(.{ .ctrl_shift = 'k' }));
    try std.testing.expectEqual(@as(?Command, .add_cursor_down), mapEditor(.{ .ctrl_shift = 'j' }));
    try std.testing.expectEqual(@as(?Command, .clear_multi_cursor), mapEditor(.{ .ctrl_shift = 'm' }));
}

test "maps multi-cursor shortcuts on cmd+shift" {
    try std.testing.expectEqual(@as(?Command, .add_cursor_up), mapEditor(.{ .cmd_shift = 'k' }));
    try std.testing.expectEqual(@as(?Command, .add_cursor_down), mapEditor(.{ .cmd_shift = 'j' }));
    try std.testing.expectEqual(@as(?Command, .clear_multi_cursor), mapEditor(.{ .cmd_shift = 'm' }));
}
